{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\src\\permission.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\src\\permission.js","mtime":1620833396788},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\Desktop\\django-vue-admin\\dvadmin-ui\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvZGphbmdvLXZ1ZS1hZG1pbi9kdmFkbWluLXVpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdCIpLmRlZmF1bHQ7Cgp2YXIgX29iamVjdFNwcmVhZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkM6L1VzZXJzL0FkbWluaXN0cmF0b3IvRGVza3RvcC9kamFuZ28tdnVlLWFkbWluL2R2YWRtaW4tdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvb2JqZWN0U3ByZWFkMiIpKTsKCnZhciBfcm91dGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL3JvdXRlciIpKTsKCnZhciBfc3RvcmUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vc3RvcmUiKSk7Cgp2YXIgX2VsZW1lbnRVaSA9IHJlcXVpcmUoImVsZW1lbnQtdWkiKTsKCnZhciBfbnByb2dyZXNzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJucHJvZ3Jlc3MiKSk7CgpyZXF1aXJlKCJucHJvZ3Jlc3MvbnByb2dyZXNzLmNzcyIpOwoKdmFyIF9hdXRoID0gcmVxdWlyZSgiQC91dGlscy9hdXRoIik7CgpfbnByb2dyZXNzLmRlZmF1bHQuY29uZmlndXJlKHsKICBzaG93U3Bpbm5lcjogZmFsc2UKfSk7Cgp2YXIgd2hpdGVMaXN0ID0gWycvbG9naW4nLCAnL2F1dGgtcmVkaXJlY3QnLCAnL2JpbmQnLCAnL3JlZ2lzdGVyJ107Cgpfcm91dGVyLmRlZmF1bHQuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICBfbnByb2dyZXNzLmRlZmF1bHQuc3RhcnQoKTsKCiAgaWYgKCgwLCBfYXV0aC5nZXRUb2tlbikoKSkgewogICAgLyogaGFzIHRva2VuKi8KICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnLycKICAgICAgfSk7CgogICAgICBfbnByb2dyZXNzLmRlZmF1bHQuZG9uZSgpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKF9zdG9yZS5kZWZhdWx0LmdldHRlcnMucm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8g5Yik5pat5b2T5YmN55So5oi35piv5ZCm5bey5ouJ5Y+W5a6MdXNlcl9pbmZv5L+h5oGvCiAgICAgICAgX3N0b3JlLmRlZmF1bHQuZGlzcGF0Y2goJ0dldEluZm8nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIC8vIOaLieWPlnVzZXJfaW5mbwogICAgICAgICAgdmFyIHJvbGVzID0gcmVzLnJvbGVzOwoKICAgICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCdHZW5lcmF0ZVJvdXRlcycsIHsKICAgICAgICAgICAgcm9sZXM6IHJvbGVzCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChhY2Nlc3NSb3V0ZXMpIHsKICAgICAgICAgICAgLy8g5qC55o2ucm9sZXPmnYPpmZDnlJ/miJDlj6/orr/pl67nmoTot6/nlLHooagKICAgICAgICAgICAgX3JvdXRlci5kZWZhdWx0LmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOyAvLyDliqjmgIHmt7vliqDlj6/orr/pl67ot6/nlLHooagKCgogICAgICAgICAgICBuZXh0KCgwLCBfb2JqZWN0U3ByZWFkMi5kZWZhdWx0KSgoMCwgX29iamVjdFNwcmVhZDIuZGVmYXVsdCkoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgIH0pKTsgLy8gaGFja+aWueazlSDnoa7kv51hZGRSb3V0ZXPlt7LlrozmiJAKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCdMb2dPdXQnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX2VsZW1lbnRVaS5NZXNzYWdlLmVycm9yKGVycik7CgogICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICBwYXRoOiAnLycKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgLy8g5rKh5pyJdG9rZW4KICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgLy8g5Zyo5YWN55m75b2V55m95ZCN5Y2V77yM55u05o6l6L+b5YWlCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5mdWxsUGF0aCkpOyAvLyDlkKbliJnlhajpg6jph43lrprlkJHliLDnmbvlvZXpobUKCiAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CiAgICB9CiAgfQp9KTsKCl9yb3V0ZXIuZGVmYXVsdC5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7Cn0pOw=="},{"version":3,"sources":["C:/Users/Administrator/Desktop/django-vue-admin/dvadmin-ui/src/permission.js"],"names":["NProgress","configure","showSpinner","whiteList","router","beforeEach","to","from","next","start","path","done","store","getters","roles","length","dispatch","then","res","accessRoutes","addRoutes","replace","catch","err","Message","error","indexOf","fullPath","afterEach"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEAA,mBAAUC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB;;AAEA,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,OAA7B,EAAsC,WAAtC,CAAlB;;AAEAC,gBAAOC,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpCR,qBAAUS,KAAV;;AACA,MAAI,qBAAJ,EAAgB;AACd;AACA,QAAIH,EAAE,CAACI,IAAH,KAAY,QAAhB,EAA0B;AACxBF,MAAAA,IAAI,CAAC;AAAEE,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAJ;;AACAV,yBAAUW,IAAV;AACD,KAHD,MAGO;AACL,UAAIC,eAAMC,OAAN,CAAcC,KAAd,CAAoBC,MAApB,KAA+B,CAAnC,EAAsC;AACpC;AACAH,uBAAMI,QAAN,CAAe,SAAf,EAA0BC,IAA1B,CAA+B,UAAAC,GAAG,EAAI;AACpC;AACA,cAAMJ,KAAK,GAAGI,GAAG,CAACJ,KAAlB;;AACAF,yBAAMI,QAAN,CAAe,gBAAf,EAAiC;AAAEF,YAAAA,KAAK,EAALA;AAAF,WAAjC,EAA4CG,IAA5C,CAAiD,UAAAE,YAAY,EAAI;AAC/D;AACAf,4BAAOgB,SAAP,CAAiBD,YAAjB,EAF+D,CAEhC;;;AAC/BX,YAAAA,IAAI,6DAAMF,EAAN;AAAUe,cAAAA,OAAO,EAAE;AAAnB,eAAJ,CAH+D,CAGhC;AAChC,WAJD;AAKD,SARD,EAQGC,KARH,CAQS,UAAAC,GAAG,EAAI;AACZX,yBAAMI,QAAN,CAAe,QAAf,EAAyBC,IAAzB,CAA8B,YAAM;AAClCO,+BAAQC,KAAR,CAAcF,GAAd;;AACAf,YAAAA,IAAI,CAAC;AAAEE,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACD,WAHD;AAID,SAbH;AAcD,OAhBD,MAgBO;AACLF,QAAAA,IAAI;AACL;AACF;AACF,GA1BD,MA0BO;AACL;AACA,QAAIL,SAAS,CAACuB,OAAV,CAAkBpB,EAAE,CAACI,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAF,MAAAA,IAAI;AACL,KAHD,MAGO;AACLA,MAAAA,IAAI,2BAAoBF,EAAE,CAACqB,QAAvB,EAAJ,CADK,CACkC;;AACvC3B,yBAAUW,IAAV;AACD;AACF;AACF,CAtCD;;AAwCAP,gBAAOwB,SAAP,CAAiB,YAAM;AACrB5B,qBAAUW,IAAV;AACD,CAFD","sourcesContent":["import router from './router'\nimport store from './store'\nimport { Message } from 'element-ui'\nimport NProgress from 'nprogress'\nimport 'nprogress/nprogress.css'\nimport { getToken } from '@/utils/auth'\n\nNProgress.configure({ showSpinner: false })\n\nconst whiteList = ['/login', '/auth-redirect', '/bind', '/register']\n\nrouter.beforeEach((to, from, next) => {\n  NProgress.start()\n  if (getToken()) {\n    /* has token*/\n    if (to.path === '/login') {\n      next({ path: '/' })\n      NProgress.done()\n    } else {\n      if (store.getters.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        store.dispatch('GetInfo').then(res => {\n          // 拉取user_info\n          const roles = res.roles\n          store.dispatch('GenerateRoutes', { roles }).then(accessRoutes => {\n            // 根据roles权限生成可访问的路由表\n            router.addRoutes(accessRoutes) // 动态添加可访问路由表\n            next({ ...to, replace: true }) // hack方法 确保addRoutes已完成\n          })\n        }).catch(err => {\n            store.dispatch('LogOut').then(() => {\n              Message.error(err)\n              next({ path: '/' })\n            })\n          })\n      } else {\n        next()\n      }\n    }\n  } else {\n    // 没有token\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next()\n    } else {\n      next(`/login?redirect=${to.fullPath}`) // 否则全部重定向到登录页\n      NProgress.done()\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done()\n})\n"]}]}